

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>&lt;no title&gt; &mdash; 1.3.1</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  
  
  
    <link rel="canonical" href="https://podpac.orgspecs/data-source.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/icon.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../settings.html">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="../settings.html#id18">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="../settings.html#id71">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="../settings.html#id92">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nodes.html">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nodes.html#id10">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nodes.html#id19">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nodes.html#id22">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nodes.html#id25">}</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PODPAC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>&lt;no title&gt;</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/specs/data-source.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p># Requirements</p>
<ul class="simple">
<li><p>Quick and simple to define arbitrary data source given podpac Coordinates and some kind of data</p></li>
<li><p>Provide a base class for all other data types, including user defined data types</p></li>
</ul>
<p># Example Use cases</p>
<ul class="simple">
<li><p>I want to load tabular data from a local file and create a podpac data source quickly</p></li>
<li><p>I want to create a data source class that provides access to a new server that serves GeoTIFF data</p></li>
<li><p>I want to create a data source class the provides access to a new flat file data source</p></li>
<li><p>I want to access my data on Backblaze B2 instead of S3 bucket</p></li>
<li><p>I want to access a GeoServer which implements WCS</p></li>
<li><p>I want to provide access to a new NASA dataset that is stored on S3 in a new data format</p></li>
</ul>
<p># Specification</p>
<p>## DataSource Class</p>
<p><cite>DataSource(Node)</cite> is the base class from which all data other data sources are implemented. Extends the <cite>Node</cite> base class.</p>
<p>#### Traits</p>
<p>(See [Node documentation](<a class="reference external" href="https://podpac.org/user/api/podpac.core.node.html#podpac.core.node.Node">https://podpac.org/user/api/podpac.core.node.html#podpac.core.node.Node</a>) for nodes attributes)</p>
<ul>
<li><dl class="simple">
<dt><cite>source</cite>: Any, required</dt><dd><ul class="simple">
<li><p>The location of the source. Depending on the child node this can be a filepath, numpy array, or dictionary as a few examples.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt><cite>interpolation</cite>:</dt><dd><blockquote>
<div><ul class="simple">
<li><p>str, tuple (str, list of podpac.core.data.interpolate.Interpolator)</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Definition of interpolation methods for each dimension of the native coordinates. If input is a string, it must match one of the interpolation shortcuts defined in</p></li>
</ul>
<p>:ref:podpac.core.data.interpolate.INTERPOLATION_SHORTCUTS. The interpolation method associated
with this string will be applied to all dimensions in the native coordinates.
- If input is a tuple, the first element of the tuple must be a string interpolation method name.
The second element must be a list of :ref:podpac.core.data.interpolate.Interpolator. This list specifies
the order in which the interpolators will be applied.
The interpolation method defined by this tuple will be applied to all dimensions in the native coordinates.
- If input is a dict, the key must be string dimension names. The value can be a string or tuple following
the same convention as specified above. The string or tuple will be applied
to the dimension specied by the key. An exception will be raised if the dictionary
does not contain a key for all unstacked dimensions of the native coodrinates.
All dimension keys must be unstacked even if the underlying coordinate dimensions are stacked.
- If input is a podpac.core.data.interpolate.Interpolation, this interpolator will be used without modication.
- By default, the interpolation method is set to <cite>‘nearest’</cite> for all dimensions.</p>
</dd>
</dl>
</li>
<li><p><cite>coordinate_index_type</cite>: Enum(‘list’,’numpy’,’xarray’,’pandas’). By default this is <cite>numpy</cite></p></li>
<li><dl class="simple">
<dt><cite>nan_vals</cite>: List</dt><dd><ul class="simple">
<li><p>list of values from source data that should be interpreted as ‘no data’ or ‘nans’ (replaces <cite>no_data_vals</cite>)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>#### Private Members</p>
<ul class="simple">
<li><p><cite>_interpolation</cite> - tl.Instance(Interpolation).  Interpolation method returned from Interpolation(<cite>interpolation</cite>) constructor</p></li>
</ul>
<p><em>TODO</em> : the names of these memebers will be changed</p>
<ul class="simple">
<li><p><cite>_requested_coordinates</cite> = tl.Instance(Coordinates, allow_none=True)</p></li>
<li><p><cite>_requested_source_coordinates</cite> = tl.Instance(Coordinates)</p></li>
<li><p><cite>_requested_source_coordinates_index</cite> = tl.List()</p></li>
<li><p><cite>_requested_source_data</cite> = tl.Instance(UnitsDataArray)</p></li>
</ul>
<p>#### Properties</p>
<p>#### Contructor</p>
<ul class="simple">
<li><dl class="simple">
<dt>FUTURE: After implementing a limiter on the request size, implement:</dt><dd><ul>
<li><p>Take one input (i.e. <cite>evaluate</cite>) that will automatically execute the datasource at the native_coordinates on contruction. This will allow a shortcut when you just want to load a simple data source for processing with other more complication data sources</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>#### Methods</p>
<ul class="simple">
<li><dl class="simple">
<dt><cite>eval(coordinates, output=None, method=None)</cite>: Evaluate this node using the supplied coordinates</dt><dd><ul>
<li><p><cite>self.requested_coordinates</cite> gets set to the coordinates that are input</p></li>
<li><p>Instantiate <cite>_interpolation</cite>  classes with data sources based on input to <cite>interpolation</cite></p></li>
<li><p>remove dims that don’t exist in native coordinates</p></li>
<li><p>intersect the <cite>self.requested_coordinates</cite> with <cite>self.native_coordinates</cite> to create <cite>self.requested_source_coordinates</cite> and <cite>self.requested_source_coordinates_index</cite> to get requested via <cite>get_data</cite>.  DataSource <cite>coordinate_index_type</cite> informs <cite>self.requested_source_coordinates_index</cite> (Array[int], Array[boolean], List[slices])</p></li>
<li><p>interpolate requested coordinates <cite>self.requested_source_coordinates</cite> using <cite>_interpolate_requested_coordinates()</cite>.</p></li>
<li><p><cite>self.requested_source_coordinates</cite> coordinates MUST exists exactly in the data source native coordinates.</p></li>
<li><p>run <cite>_get_data</cite> which runs the user defined <cite>get_data()</cite> and check/fix order of dims when UnitsDataArray or Xarray is returned from get_data. Otherwise create UnitsDataArray using values from get_data and requested_source_coordinates. This return from <cite>_get_data()</cite> sets <cite>self.requested_source_data</cite></p></li>
<li><p>Run <cite>_interpolate()</cite></p></li>
<li><p>Set <cite>self.evaluated</cite> to True</p></li>
<li><p>Output the user the UnitsDataArray passed back from interpolate</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>get_data(coordinates, coordinates_index)</cite>:</dt><dd><ul>
<li><p>Raise a <cite>NotImplementedError</cite></p></li>
<li><p><cite>coordinates</cite> and <cite>coordinates_index</cite> are guarenteed to exists in the datasource</p></li>
<li><dl class="simple">
<dt>return an UnitsDataArray, numpy array, or xarray of values. this will get turned into a UnitsDataArray aftwards using <cite>self.requested_source_coordinates</cite> even if the xarray passes back coordinates</dt><dd><ul>
<li><p>Need to check/fix order of dims in UnitsDataArray and Xarray case</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p><cite>get_native_coordinates()</cite>: return the native coordinates from the data source. By default, this should return <cite>self.native_coordinates</cite> if defined, otherwise raise a <cite>NotImplementedError</cite></p></li>
<li><dl class="simple">
<dt><cite>definition()</cite>: Pipeline node definition for DataSource nodes.</dt><dd><ul>
<li><p>Transport mechanism for going to the cloud</p></li>
<li><p>Leave as is</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>#### Private Methods</p>
<ul class="simple">
<li><dl class="simple">
<dt><cite>_interpolate_requested_coordinates()</cite>: Use <cite>self.requested_coordinates</cite>, <cite>self.native_coordinates</cite>, <cite>self.interpolate</cite> to determine the requested coordinates interpolated into the source coordinates.</dt><dd><ul>
<li><p>overwrites <cite>self.requested_source_coordinates</cite> (Coordinates) to interpolated coordinates that need to get requested from the data source via <cite>get_data</cite>.</p></li>
<li><p>These coordinates MUST exists exactly in the data source native coordinates</p></li>
<li><p>Returns None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>_interpolate()</cite>: Use <cite>self.interpolate</cite> and call the appropriate functions in the <cite>interpolate</cite> module</dt><dd><ul>
<li><p>Returns a UnitDataArray which becomes the output of the eval method</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>#### Operators</p>
<p>## User Interface</p>
<p>Simple datasource that doesn’t need its own subclass</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>python
class ArraySource(DataSource):</p>
<blockquote>
<div><p>source = tl.Instance(np.ndarray)</p>
<dl class="simple">
<dt>def get_data(self, coordinates, coordinates_index):</dt><dd><p>return self.source[coordinates_index]</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<p>Using this basic class</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">source</span> <span class="pre">=</span> <span class="pre">np.random.rand(101,</span> <span class="pre">101)</span>
<span class="pre">source_coordinates</span> <span class="pre">=</span> <span class="pre">coordinates(lat=(-25,</span> <span class="pre">25,</span> <span class="pre">101),</span> <span class="pre">lon=(-25,</span> <span class="pre">25,</span> <span class="pre">101),</span> <span class="pre">order=['lat',</span> <span class="pre">'lon'])</span>
<span class="pre">node</span> <span class="pre">=</span> <span class="pre">ArraySource(source=source,</span> <span class="pre">native_coordinates=source_coordinates)</span>
<span class="pre">output</span> <span class="pre">=</span> <span class="pre">node.eval(node.native_coordinates)</span>
<span class="pre">`</span></code></p>
<p>FUTURE: automatically execute</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">source</span> <span class="pre">=</span> <span class="pre">np.random.rand(101,</span> <span class="pre">101)</span>
<span class="pre">source_coordinates</span> <span class="pre">=</span> <span class="pre">coordinates(lat=(-25,</span> <span class="pre">25,</span> <span class="pre">101),</span> <span class="pre">lon=(-25,</span> <span class="pre">25,</span> <span class="pre">101),</span> <span class="pre">order=['lat',</span> <span class="pre">'lon'])</span>
<span class="pre">node</span> <span class="pre">=</span> <span class="pre">ArraySource(source=source,</span> <span class="pre">native_coordinates=source_coordinates)</span>
<span class="pre">output</span> <span class="pre">=</span> <span class="pre">node.eval()</span>
<span class="pre">`</span></code></p>
<p>More Complicated Source.
This datasource gets new <cite>native_coordinates</cite> every time the source updates.</p>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a>python
class RasterioSource(DataSource):</p>
<blockquote>
<div><p>source = tl.Unicode(allow_none=False)  # specifies source MUST be a Unicode
dataset = tl.Any(allow_none=True)
band = tl.CInt(1).tag(attr=True)</p>
<p>&#64;tl.default(‘dataset’)
def open_dataset(self, source):</p>
<blockquote>
<div><p>return module.open(source)</p>
</div></blockquote>
<p>&#64;tl.observe(‘source’)
def _update_dataset(self):</p>
<blockquote>
<div><p>self.dataset = self.open_dataset()
self.native_coordinates = self.get_native_coordinates()</p>
</div></blockquote>
<dl>
<dt>def get_native_coordinates(self):</dt><dd><p>dlon = self.dataset.width
dlat = self.dataset.height
left, bottom, right, top = self.dataset.bounds</p>
<dl class="simple">
<dt>return podpac.Coordinate(lat=(top, bottom, dlat),</dt><dd><p>lon=(left, right, dlon),
order=[‘lat’, ‘lon’])</p>
</dd>
</dl>
</dd>
<dt>def get_data(self, coordinates, coordinates_index):</dt><dd><p>data = self.dataset.read(coordinates_index)
return data</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id13"><span class="problematic" id="id14">``</span></a><a href="#id15"><span class="problematic" id="id16">`</span></a></p>
<p>## Developer interface</p>
<p>TODO: Add developer interface specs</p>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2020, Creare

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>