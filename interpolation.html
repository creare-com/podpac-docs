<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>} &mdash; 3.2.0+1.g44ea00f8</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="canonical" href="https://podpac.orginterpolation.html"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="&lt;no title&gt;" href="earthdata.html" />
    <link rel="prev" title="&lt;no title&gt;" href="datasets.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/icon.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="settings.html">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html#id18">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html#id71">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html#id92">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Topics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodes.html">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodes.html#id10">]</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodes.html#id19">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodes.html#id22">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodes.html#id25">}</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id10">]</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id15">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id20">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id25">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id30">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id35">]</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PODPAC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">}</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/interpolation.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p># Interpolation</p>
<p>## Description</p>
<p>PODPAC allows users to specify various different interpolation schemes for nodes with
increased granularity, and even lets users write their own interpolators. By default
PODPAC uses the <cite>podpac.settings[“DEFAULT_INTERPOLATION”] == “nearest”</cite>, which may
be modified by users. Users who wish to see raw datasources can also use <cite>“none”</cite>
for the interpolator type.</p>
<p>Relevant example notebooks include:
* [Advanced Interpolation](<a class="reference external" href="https://github.com/creare-com/podpac-examples/blob/master/notebooks/4-advanced/interpolation.ipynb">https://github.com/creare-com/podpac-examples/blob/master/notebooks/4-advanced/interpolation.ipynb</a>)
* [Basic Interpolation](<a class="reference external" href="https://github.com/creare-com/podpac-examples/blob/master/notebooks/2-combining-data/automatic-interpolation-and-regridding.ipynb">https://github.com/creare-com/podpac-examples/blob/master/notebooks/2-combining-data/automatic-interpolation-and-regridding.ipynb</a>)
* [Drought Monitor Data Access Harmonization Processing](<a class="reference external" href="https://github.com/creare-com/podpac-examples/blob/master/notebooks/examples/drought-monitor/03-data-access-harmonization-processing.ipynb">https://github.com/creare-com/podpac-examples/blob/master/notebooks/examples/drought-monitor/03-data-access-harmonization-processing.ipynb</a>)</p>
<p>## Examples
Consider a <cite>DataSource</cite> with <cite>lat</cite>, <cite>lon</cite>, <cite>time</cite> coordinates that we will instantiate as:
<cite>node = DataSource(…, interpolation=interpolation)</cite></p>
<p><cite>interpolation</cite> can be specified …</p>
<p>### …as a string</p>
<p><cite>interpolation=’nearest’</cite>
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
* <strong>Descripition</strong>: All dimensions are interpolated using nearest neighbor interpolation. This is the default, but available options can be found here: <cite>podpac.core.interpolation.interpolation.INTERPOLATION_METHODS</cite>. In particular, for no interpolation, use <cite>interpolation=”none”</cite>. <em>NOTE</em> the <cite>none</cite> interpolator ONLY considers the bounds of any evaluated coordinates. This means the data is returned at FULL resolution (no striding or sub-selection).
* <strong>Details</strong>: PODPAC will automatically select appropriate interpolators based on the source coordinates and eval coordinates. Default interpolator orders can be found in <cite>podpac.core.interpolation.interpolation.INTERPOLATION_METHODS_DICT</cite></p>
<p>### …as a dictionary</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>python
interpolation = {</p>
<blockquote>
<div><p>‘method’: ‘nearest’,
‘params’: {    # Optional. Available parameters depend on the particular interpolator</p>
<blockquote>
<div><p>‘spatial_tolerance’: 1.1,
‘time_tolerance’: np.timedelta64(1, ‘D’)</p>
</div></blockquote>
<p>},
‘interpolators’: [ScipyGrid, NearestNeighbor]  # Optional. Available options are in podpac.core.interpolation.interpolation.INTERPOLATORS</p>
</div></blockquote>
<section id="id5">
<h1>}<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p><strong>Descripition</strong>: All dimensions are interpolated using nearest neighbor interpolation, and the type of interpolators are tried in the order specified. For applicable interpolators, the specified parameters will be used.</p></li>
<li><p><strong>Details</strong>: PODPAC loops through the <cite>interpolators</cite> list, checking if the interpolator is able to interpolate between the evaluated and source coordinates. The first capable interpolator available will be used.</p></li>
</ul>
<p>### …as a list</p>
<p><a href="#id6"><span class="problematic" id="id7">``</span></a><a href="#id8"><span class="problematic" id="id9">`</span></a>python
interpolation = [</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>‘method’: ‘bilinear’,
‘dims’: [‘lat’, ‘lon’]</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>‘method’: ‘nearest’,
‘dims’: [‘time’]</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</section>
<section id="id10">
<h1>]<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p><strong>Descripition</strong>: The dimensions listed in the <cite>‘dims’</cite> list will used the specified method. These dictionaries can also specify the same field shown in the previous section.</p></li>
<li><p><strong>Details</strong>: PODPAC loops through the <cite>interpolation</cite> list, using the settings specified for each dimension independently.</p></li>
</ul>
<p><strong>NOTE! Specifying the interpolation as a list also control the ORDER of interpolation.</strong>
The first item in the list will be interpolated first. In this case, <cite>lat</cite>/<cite>lon</cite> will be bilinearly interpolated BEFORE <cite>time</cite> is nearest-neighbor interpolated.</p>
<p>## Interpolators
The list of available interpolators are as follows:
* <cite>NoneInterpolator</cite>: An interpolator that passes through the raw, source data at full resolution – it does not do any interpolation. <strong>Note</strong>: This interpolator can be used for <strong>some</strong> of the dimension by specifying <cite>interpolation</cite> as a list.
* <cite>NearestNeighbor</cite>: A custom implementation based on <cite>scipy.cKDtree</cite>, which handles nearly any combination of source and destination coordinates
* <cite>XarrayInterpolator</cite>: A light-weight wrapper around <cite>xarray</cite>’s <cite>DataArray.interp</cite> method, which is itself a wrapper around <cite>scipy</cite> interpolation functions, but with a clean <cite>xarray</cite> interface
* <cite>RasterioInterpolator</cite>: A wrapper around <cite>rasterio</cite>’s interpolation/reprojection routines. Appropriate for grid-to-grid interpolation.
* <cite>ScipyGrid</cite>: An optimized implementation for <cite>grid</cite> sources that uses <cite>scipy</cite>’s <cite>RegularGridInterpolator</cite>, or <cite>RectBivariateSplit</cite> interpolator depending on the method.
* <cite>ScipyPoint</cite>: An implementation based on <cite>scipy.KDtree</cite> capable of <cite>nearest</cite> interpolation for <cite>point</cite> sources
* <cite>NearestPreview</cite>: An approximate nearest-neighbor interpolator useful for rapidly viewing large files</p>
<p>The default order for these interpolators can be found in <cite>podpac.data.INTERPOLATORS</cite>.</p>
<p>### NearestNeighbor
Since this is the most general of the interpolators, this section deals with the available parameters and settings for the <cite>NearestNeighbor</cite> interpolator.</p>
<p>#### Parameters
The following parameters can be set by specifying the interpolation as a dictionary or a list, as described above.</p>
<ul>
<li><p><cite>respect_bounds</cite> : <cite>bool</cite>
* Default is <cite>True</cite>. If <cite>True</cite>, any requested dimension OUTSIDE of the bounds will be interpolated as <cite>nan</cite>.</p>
<blockquote>
<div><p>Otherwise, any point outside the bounds will have the value of the nearest neighboring point</p>
</div></blockquote>
</li>
<li><p><cite>remove_nan</cite> : <cite>bool</cite>
* Default is <cite>False</cite>. If <cite>True</cite>, <cite>nan</cite>’s in the source dataset will NOT be interpolated. This can be used if a value for the function</p>
<blockquote>
<div><p>is needed at every point of the request. It is not helpful when computing statistics, where <cite>nan</cite> values will be explicitly
ignored. In that case, if <cite>remove_nan</cite> is <cite>True</cite>, <cite>nan</cite> values will take on the values of neighbors, skewing the statistical result.</p>
</div></blockquote>
</li>
<li><p><cite>*_tolerance</cite> : <cite>float</cite>, where <cite>*</cite> in [“spatial”, “time”, “alt”]
* Default is <cite>inf</cite>. Maximum distance to the nearest coordinate to be interpolated.</p>
<blockquote>
<div><p>Corresponds to the unit of the <cite>*</cite> dimension.</p>
</div></blockquote>
</li>
<li><p><cite>*_scale</cite> : <cite>float</cite>, where <cite>*</cite> in [“spatial”, “time”, “alt”]
* Default is <cite>1</cite>. This only applies when the source has stacked dimensions with different units. The <cite>*_scale</cite></p>
<blockquote>
<div><blockquote>
<div><p>defines the factor that the coordinates will be scaled by (coordinates are divided by <cite>*_scale</cite>) to output
a valid distance for the combined set of dimensions.
For example, when “lat, lon, and alt” dimensions are stacked, [“lat”, “lon”] are in degrees
and “alt” is in feet, the <cite>*_scale</cite> parameters should be set so that</p>
</div></blockquote>
<p><cite>|| [dlat / spatial_scale, dlon / spatial_scale, dalt / alt_scale] ||</cite> results in a reasonable distance.</p>
</div></blockquote>
</li>
<li><p><cite>use_selector</cite> : <cite>bool</cite>
* Default is <cite>True</cite>. If <cite>True</cite>, a subset of the coordinates will be selected BEFORE the data of a dataset is retrieved. This</p>
<blockquote>
<div><p>reduces the number of data retrievals needed for large datasets. In cases where <cite>remove_nan</cite> = <cite>True</cite>, the selector may select
only <cite>nan</cite> points, in which case the interpolation fails to produce non-<cite>nan</cite> data. This usually happens when requesting a single
point from a dataset that contains <cite>nan`s. As such, in these cases set `use_selector</cite> = <cite>False</cite> to get a non-<cite>nan</cite> value.</p>
</div></blockquote>
</li>
</ul>
<p>#### Advanced NearestNeighbor Interpolation Examples
* Only interpolate points that are within <cite>1</cite> of the source data lat/lon locations
<code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">interpolation={&quot;method&quot;:</span> <span class="pre">&quot;nearest&quot;,</span> <span class="pre">&quot;params&quot;:</span> <span class="pre">{&quot;spatial_tolerance&quot;:</span> <span class="pre">1}},</span>
<span class="pre">`</span></code>
* When interpolating with mixed time/space, use <cite>1</cite> day as equivalent to <cite>1</cite> degree for determining the distance
<a href="#id11"><span class="problematic" id="id12">``</span></a><a href="#id13"><span class="problematic" id="id14">`</span></a>python
interpolation={</p>
<blockquote>
<div><p>“method”: “nearest”,
“params”: {</p>
<blockquote>
<div><p>“spatial_scale”: 1,
“time_scale”: “1,D”,
“alt_scale”: 10,</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</section>
<section id="id15">
<h1>}<a class="headerlink" href="#id15" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p>Remove nan values in the source datasource – in some cases a <cite>nan</cite> may still be interpolated</p></li>
</ul>
<p><a href="#id16"><span class="problematic" id="id17">``</span></a><a href="#id18"><span class="problematic" id="id19">`</span></a>python
interpolation={</p>
<blockquote>
<div><p>“method”: “nearest”,
“params”: {</p>
<blockquote>
<div><p>“remove_nan”: True,</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</section>
<section id="id20">
<h1>}<a class="headerlink" href="#id20" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p>Remove nan values in the source datasource in all cases, even for single point requests located directly at <cite>nan</cite>-values in the source.</p></li>
</ul>
<p><a href="#id21"><span class="problematic" id="id22">``</span></a><a href="#id23"><span class="problematic" id="id24">`</span></a>python
interpolation={</p>
<blockquote>
<div><p>“method”: “nearest”,
“params”: {</p>
<blockquote>
<div><p>“remove_nan”: True,
“use_selector”: False,</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</section>
<section id="id25">
<h1>}<a class="headerlink" href="#id25" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p>Do nearest-neighbor extrapolation outside of the bounds of the source dataset</p></li>
</ul>
<p><a href="#id26"><span class="problematic" id="id27">``</span></a><a href="#id28"><span class="problematic" id="id29">`</span></a>python
interpolation={</p>
<blockquote>
<div><p>“method”: “nearest”,
“params”: {</p>
<blockquote>
<div><p>“respect_bounds”: False,</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</section>
<section id="id30">
<h1>}<a class="headerlink" href="#id30" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p>Do nearest-neighbor interpolation of time with <cite>nan</cite> removal followed by spatial interpolation</p></li>
</ul>
<p><a href="#id31"><span class="problematic" id="id32">``</span></a><a href="#id33"><span class="problematic" id="id34">`</span></a>python
interpolation = [</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><p>“method”: “nearest”,
“params”: {</p>
<blockquote>
<div><p>“remove_nan”: True,</p>
</div></blockquote>
<p>},
“dims”: [“time”]</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>“method”: “nearest”,
“dims”: [“lat”, “lon”, “alt”]</p>
</div></blockquote>
<p>},</p>
</div></blockquote>
</section>
<section id="id35">
<h1>]<a class="headerlink" href="#id35" title="Permalink to this heading"></a></h1>
<p>## Notes and Caveats
While the API is well developed, all conceivable functionality is not. For example, while we can interpolate gridded data to point data, point data to grid data interpolation is not as well supported, and there may be errors or unexpected results. Advanced users can develop their own interpolators, but this is not currently well-documented.</p>
<p><strong>Gotcha</strong>: Parameters for a specific interpolator may be ignored if a different interpolator is automatically selected. These ignored parameters are logged as warnings.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="datasets.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="earthdata.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2023, Creare.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>