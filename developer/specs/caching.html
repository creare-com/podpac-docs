

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Requirements &mdash; 0.3.0</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  
  
  
    <link rel="canonical" href="https://podpac.orgdeveloper/specs/caching.html"/>
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/icon.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../why-podpac.html">Why PODPAC?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasets.html">Supported Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Development Roadmap</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/coordinates.html">Coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/nodes.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/pipelines.html">Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/cache.html">Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/earthdata.html">NASA Earth Data Login</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/api.html">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws.html">AWS Lambda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs.html">Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PODPAC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Requirements</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/developer/specs/caching.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="requirements">
<h1>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Support storing results of calculations</p>
<ul>
<li><p>This includes:</p>
<ul>
<li><p>? numpy arrays</p></li>
<li><p>xarrays</p></li>
<li><p>UnitsDataArray</p></li>
<li><p>? DataSource</p></li>
<li><p>? other serialized binary data</p>
<ul>
<li><p>GeoTIFFs</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Cached queries are idempotent with respect to some set of parameters that define the query (location/datetime, datasource, paramters used to compute a prediction).</p></li>
<li><p>ability to retrieve calculated data from a pipeline after execution in an interactive shell for debugging or analysis purposes</p></li>
<li><p>? Support retrieval of subsets of data. For example, previous results of a calculation over North America at some resolution are cached. Does cache support retrieval of just the results for California at the same resolution? Or, does interpolation handle this in conjunction with cache? Or, does interpolation only handle it when the resolution doesn’t match. Or does caller request data using “key” of original cache and an additional “subset” parameter?</p></li>
<li><p>Support different storage mediums</p>
<ul>
<li><p>This includes:</p>
<ul>
<li><p>RAM</p></li>
<li><p>local disk (HDD/SSD)</p></li>
<li><p>AWS s3</p></li>
<li><p>? Databases (MongoDB supports geospatial queries and binary data)</p></li>
<li><p>? HDFS file system</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Support resource limitations</p>
<ul>
<li><p>This includes:</p>
<ul>
<li><p>Total number of bytes cached in RAM/disk/s3 across a process running podpac</p></li>
<li><p>Total number of bytes cached in RAM/disk/s3 across multiple processes on the same computer/server running podpac</p></li>
<li><p>Total number of bytes cached in RAM/disk/s3 across a cluster of servers running podpac</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Support prioritization of cached data under resource limitations</p>
<ul>
<li><p>Bassed on:</p>
<ul>
<li><p>size of data (bytes)</p></li>
<li><p>computational cost to reproduce (time to compute)</p></li>
<li><p>access patterns:</p>
<ul>
<li><p>frequency of use</p></li>
<li><p>recency of use</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Support expiration of data (e.g. forecast data that is updated at some time interval)</p></li>
<li><p>Support cache tiers:</p>
<ul>
<li><p>respond from “better” tier when possible (e.g. RAM)</p></li>
<li><p>fall back on “worse” tier (e.g. local disk then s3 or some other networked storage)</p></li>
</ul>
</li>
<li><p>Support saving “providence” of data with the stored data</p>
<ul>
<li><p>For archived data (local disk, s3, database, HDFS) this could be the json pipeline definition and should include:</p>
<ul>
<li><p>version of podpac that was used to create it</p></li>
<li><p>timestamp when it was created</p></li>
<li><p>information about the root datasources (version if they have it)</p></li>
<li><p>computational graph definition</p></li>
</ul>
</li>
<li><p>For in memory we may not want to be so robust but we may want include:</p>
<ul>
<li><p>Timestamp when it was computed/stored (to support expiration)</p></li>
<li><p>Possibly information about the function call that created the data (for a cached property). This maybe could be a lambda function wrapping the original function with the original args/kwargs. But would have to be careful about args/kwargs that have state that may have changed. Could we maybe force these to be “static”.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="example-use-cases">
<h1>Example Use cases<a class="headerlink" href="#example-use-cases" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>SMAP data retrieved from NASA servers while serving a request is stored on local disk for future requests.</p></li>
<li><p>Server that uses podpac to handle requests for data that involves complex computations using forecast data (e.g. weather predictions) as an input. Multiple processes are used to load-balance handling of requests. The same calculation should ideally not be performed by more than one of these processes. However, this could be subject to available RAM. In addition, results of calculations bassed on forecast data should be redone when updated forecast data becomes available.</p></li>
<li><p>Server like above, but requests are handled by a “serverless” technology like AWS lambda. Intermediate results are cached in a network storage like AWS s3 (or sharded MongoDB cluster, or HDFS filesystem).</p></li>
<li><p>TODO: Add example usecases</p></li>
</ol>
</div>
<div class="section" id="specification">
<h1>Specification<a class="headerlink" href="#specification" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cachestore">
<h2><code class="docutils literal notranslate"><span class="pre">CacheStore</span></code><a class="headerlink" href="#cachestore" title="Permalink to this headline">¶</a></h2>
<p>Abstract class representing a specific storage medium (e.g. folder on local-disk, s3-bucket, RAM).</p>
<div class="section" id="user-interface">
<h3>User Interface<a class="headerlink" href="#user-interface" title="Permalink to this headline">¶</a></h3>
<p>Starting from here for examples below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">traitlets</span> <span class="kn">as</span> <span class="nn">tl</span>
<span class="kn">from</span> <span class="nn">podpac.core.node</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">podpac.core.coordinate</span> <span class="kn">import</span> <span class="n">Coordinate</span>
<span class="kn">from</span> <span class="nn">podpac.core.units</span> <span class="kn">import</span> <span class="n">UnitsDataArray</span><span class="p">,</span> <span class="n">ureg</span>
<span class="kn">from</span> <span class="nn">podpac.core.cache</span> <span class="kn">import</span> <span class="n">DiskStore</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">()</span>
<span class="n">store</span> <span class="o">=</span> <span class="n">DiskStore</span><span class="p">()</span> <span class="c1"># assuming DiskStore is a concrete class inheriting from CacheStore</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">node</span></code> is used in the following methods to allow access to a storage “sandbox” specific to a <code class="docutils literal notranslate"><span class="pre">Node</span></code>. <code class="docutils literal notranslate"><span class="pre">store</span></code> will use methods and properties of <code class="docutils literal notranslate"><span class="pre">node</span></code> to determine which “sandbox” to use. This will mainly be a hash of <code class="docutils literal notranslate"><span class="pre">node.definition(type='json')</span></code>. A <code class="docutils literal notranslate"><span class="pre">CachStore</span></code> representing local-disk storage could also use the class inheritence of a <code class="docutils literal notranslate"><span class="pre">node</span></code> to create a user friendly directory structure, also a <code class="docutils literal notranslate"><span class="pre">node</span></code> could provide a user friendly string to prepend to any files representing cached data for the <code class="docutils literal notranslate"><span class="pre">node</span></code>.</p>
</div>
<div class="section" id="methods">
<h3>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h3>
<p>public methods</p>
<p>Put data into the cache for a node:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Cache data for specified node.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    node : Node</span>
<span class="sd">        node requesting storage.</span>
<span class="sd">    data : any</span>
<span class="sd">        Data to cache</span>
<span class="sd">    key : str</span>
<span class="sd">        Cached object key, e.g. &#39;output&#39;.</span>
<span class="sd">    coordinates : Coordinates, optional</span>
<span class="sd">        Coordinates for which cached object should be retrieved, for coordinate-dependent data such as evaluation output</span>
<span class="sd">    &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Get data from the cache:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get cached data for this node.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    node : Node</span>
<span class="sd">        node requesting storage.</span>
<span class="sd">    key : str</span>
<span class="sd">        Cached object key, e.g. &#39;output&#39;.</span>
<span class="sd">    coordinates : Coordinates, optional</span>
<span class="sd">        Coordinates for which cached object should be retrieved, for coordinate-dependent data such as evaluation output</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data : any</span>
<span class="sd">        The cached data.</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    -------</span>
<span class="sd">    CacheError</span>
<span class="sd">        If the data is not in the cache.</span>
<span class="sd">    &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Clear the cache:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Delete cached data for this node.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    node : Node</span>
<span class="sd">        node requesting storage.</span>
<span class="sd">    key : str, optional</span>
<span class="sd">        Delete only cached objects with this key.</span>
<span class="sd">    coordinates : Coordinates</span>
<span class="sd">        Delete only cached objects for these coordinates.</span>
<span class="sd">    &#39;&#39;&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>delete the entire cache: <code class="docutils literal notranslate"><span class="pre">store.rem()</span></code></p></li>
<li><p>delete the entire cache for a node: <code class="docutils literal notranslate"><span class="pre">store.rem(node)</span></code></p></li>
<li><p>delete a specific cached object (coordinate-depedent): <code class="docutils literal notranslate"><span class="pre">store.rem(node=node,</span> <span class="pre">key=mykey,</span> <span class="pre">coordinates=coords)</span></code></p></li>
<li><p>delete a specific cached object (coordinate-independent): <code class="docutils literal notranslate"><span class="pre">store.rem(node=node,</span> <span class="pre">key=mykey)</span></code></p></li>
<li><p>delete all cached data for a node for specific coordinates: <code class="docutils literal notranslate"><span class="pre">store.rem(node=node,</span> <span class="pre">coordinates=coords)</span></code></p></li>
<li><p>delete all cached objects for a node with a given key for any coordinates: <code class="docutils literal notranslate"><span class="pre">store.rem(node=node,</span> <span class="pre">key=mykey)</span></code></p></li>
</ul>
<p>Just check the cache:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">has</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Check for cached data for this node</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    node : Node</span>
<span class="sd">        node requesting storage.</span>
<span class="sd">    key : str</span>
<span class="sd">        Cached object key, e.g. &#39;output&#39;.</span>
<span class="sd">    coordinates: Coordinate, optional</span>
<span class="sd">        Coordinates for which cached object should be checked</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    has_cache : bool</span>
<span class="sd">         True if there as a cached object for this node for the given key and coordinates.</span>
<span class="sd">    &#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="developer-interface">
<h3>Developer interface<a class="headerlink" href="#developer-interface" title="Permalink to this headline">¶</a></h3>
<div class="section" id="public-attributes">
<h4>Public Attributes<a class="headerlink" href="#public-attributes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cache_types</span></code> : categories the <code class="docutils literal notranslate"><span class="pre">CacheStore</span></code> files under, e.g. <code class="docutils literal notranslate"><span class="pre">ram</span></code>,<code class="docutils literal notranslate"><span class="pre">disk</span></code>,<code class="docutils literal notranslate"><span class="pre">network</span></code>.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="cachectrl">
<h2><code class="docutils literal notranslate"><span class="pre">CacheCtrl</span></code><a class="headerlink" href="#cachectrl" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>User interface<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Starting from here for examples below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">traitlets</span> <span class="kn">as</span> <span class="nn">tl</span>
<span class="kn">from</span> <span class="nn">podpac.core.node</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">podpac.core.coordinate</span> <span class="kn">import</span> <span class="n">Coordinate</span>
<span class="kn">from</span> <span class="nn">podpac.core.units</span> <span class="kn">import</span> <span class="n">UnitsDataArray</span><span class="p">,</span> <span class="n">ureg</span>
<span class="kn">from</span> <span class="nn">podpac.core.cache</span> <span class="kn">import</span> <span class="n">CacheCtrl</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">()</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">CacheCtrl</span><span class="p">()</span> <span class="c1"># assuming DiskStore is a concrete class inheriting from CacheStore</span>
</pre></div>
</div>
<p>Instances hold a collection of <code class="docutils literal notranslate"><span class="pre">CacheStore</span></code> objects. Could be an ordered list representing the tiers to look in, e.g. first look in RAM, then local-disk, then s3. Alternatively, <code class="docutils literal notranslate"><span class="pre">CacheStore</span></code> could hold its own fall-back (e.g. a RAM <code class="docutils literal notranslate"><span class="pre">CacheStore</span></code> falls back on a local-disk <code class="docutils literal notranslate"><span class="pre">CacheStore</span></code>)</p>
</div>
<div class="section" id="id2">
<h3>Methods<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>public methods</p>
<p>Put data into the cache for a node:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Cache data for specified node.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    node : Node</span>
<span class="sd">        node requesting storage.</span>
<span class="sd">    data : any</span>
<span class="sd">        Data to cache</span>
<span class="sd">    key : str</span>
<span class="sd">        Cached object key, e.g. &#39;output&#39;.</span>
<span class="sd">    coordinates : Coordinates, optional</span>
<span class="sd">        Coordinates for which cached object should be retrieved, for coordinate-dependent data such as evaluation output</span>
<span class="sd">    mode : str</span>
<span class="sd">        determines what types of the `CacheStore` are affected: &#39;ram&#39;,&#39;disk&#39;,&#39;network&#39;,&#39;all&#39;. Defaults to `node._cache_mode` or &#39;all&#39;. Overriden by `self._cache_mode` if `self._cache_mode` is not `None`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Get data from the cache:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get cached data for this node.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    node : Node</span>
<span class="sd">        node requesting storage.</span>
<span class="sd">    key : str</span>
<span class="sd">        Cached object key, e.g. &#39;output&#39;.</span>
<span class="sd">    coordinates : Coordinates, optional</span>
<span class="sd">        Coordinates for which cached object should be retrieved, for coordinate-dependent data such as evaluation output</span>
<span class="sd">    mode : str</span>
<span class="sd">        determines what types of the `CacheStore` are affected: &#39;ram&#39;,&#39;disk&#39;,&#39;network&#39;,&#39;all&#39;. Defaults to `node._cache_mode` or &#39;all&#39;. Overriden by `self._cache_mode` if `self._cache_mode` is not `None`.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data : any</span>
<span class="sd">        The cached data.</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    -------</span>
<span class="sd">    CacheError</span>
<span class="sd">        If the data is not in the cache.</span>
<span class="sd">    &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Clear the cache:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Delete cached data for this node.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    node : Node</span>
<span class="sd">        node requesting storage.</span>
<span class="sd">    key : str, optional</span>
<span class="sd">        Delete only cached objects with this key.</span>
<span class="sd">    coordinates : Coordinates</span>
<span class="sd">        Delete only cached objects for these coordinates.</span>
<span class="sd">    mode : str</span>
<span class="sd">        determines what types of the `CacheStore` are affected: &#39;ram&#39;,&#39;disk&#39;,&#39;network&#39;,&#39;all&#39;. Defaults to `node._cache_mode` or &#39;all&#39;. Overriden by `self._cache_mode` if `self._cache_mode` is not `None`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>delete the entire cache: <code class="docutils literal notranslate"><span class="pre">cache.rem()</span></code></p></li>
<li><p>delete the entire cache for a node: <code class="docutils literal notranslate"><span class="pre">cache.rem(node)</span></code></p></li>
<li><p>delete a specific cached object (coordinate-depedent): <code class="docutils literal notranslate"><span class="pre">cache.rem(node=node,</span> <span class="pre">key=mykey,</span> <span class="pre">coordinates=coords)</span></code></p></li>
<li><p>delete a specific cached object (coordinate-independent): <code class="docutils literal notranslate"><span class="pre">cache.rem(node=node,</span> <span class="pre">key=mykey)</span></code></p></li>
<li><p>delete all cached data for a node for specific coordinates: <code class="docutils literal notranslate"><span class="pre">cache.rem(node=node,</span> <span class="pre">coordinates=coords)</span></code></p></li>
<li><p>delete all cached objects for a node with a given key for any coordinates: <code class="docutils literal notranslate"><span class="pre">cache.rem(node=node,</span> <span class="pre">key=mykey)</span></code></p></li>
</ul>
<p>Just check the cache:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">has</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Check for cached data for this node</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    node : Node</span>
<span class="sd">        node requesting storage.</span>
<span class="sd">    key : str</span>
<span class="sd">        Cached object key, e.g. &#39;output&#39;.</span>
<span class="sd">    coordinates: Coordinate, optional</span>
<span class="sd">        Coordinates for which cached object should be checked</span>
<span class="sd">    mode : str</span>
<span class="sd">        determines what types of the `CacheStore` are affected: &#39;ram&#39;,&#39;disk&#39;,&#39;network&#39;,&#39;all&#39;. Defaults to `node._cache_mode` or &#39;all&#39;. Overriden by `self._cache_mode` if `self._cache_mode` is not `None`.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    has_cache : bool</span>
<span class="sd">         True if there as a cached object for this node for the given key and coordinates.</span>
<span class="sd">    &#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>Developer interface<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="section" id="private-attributes">
<h4>Private attributes<a class="headerlink" href="#private-attributes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_cache_mode</span></code> : Override for what types of the <code class="docutils literal notranslate"><span class="pre">CacheStore</span></code> are affected: ‘ram’,’disk’,’network’,’all’. If this is not <code class="docutils literal notranslate"><span class="pre">None</span></code> then <code class="docutils literal notranslate"><span class="pre">node._cache_mode</span></code> and the <code class="docutils literal notranslate"><span class="pre">mode</span></code> argument for the <code class="docutils literal notranslate"><span class="pre">CacheStore</span></code> public methods will be ignored.</p></li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="implementation-notes">
<h1>Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Idempotence can be supported using key computed via some hashing protocol. Maybe the key is the hash of a dictionary representing parameter key/values and there is some specification on the keys like the time parameter is always “datetime”.</p></li>
<li><p>Keys used to retrieve data need to support a distributed system. Basically, cache system needs to know, or be able to figure out, what server to make a request to when data is cached over some kind of network storage system (multiple s3 buckets, sharded database, HDFS).</p>
<ul>
<li><p>This can be accomplished by:</p>
<ul>
<li><p>reserving a portion of a retrieval key (hash) to specify the network resource</p>
<ul>
<li><p>could be hard to change the “key” for a particular network resource after the fact.</p></li>
<li><p>likely need to support adding (maybe deleting) network resources over time.</p></li>
</ul>
</li>
<li><p>Using a centralized lookup server</p>
<ul>
<li><p>central server could be bottleneck</p></li>
<li><p>retrieval becomes at least two network bassed queries (one to central server, and then one for data).</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>libraries to keep in mind:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/uqfoundation/pathos">pathos</a> Graph Execution Manager with generic <code class="docutils literal notranslate"><span class="pre">map</span></code> (think python map) and <code class="docutils literal notranslate"><span class="pre">pipe</span></code> (aka <code class="docutils literal notranslate"><span class="pre">apply</span></code>, not sure what this is maybe reduction) operations.</p>
<ul>
<li><p>execution manager versions (implementations) include:</p>
<ul>
<li><p>MPI</p></li>
<li><p>ssh (rpc over ssh tunnels)</p></li>
<li><p>multiprocessors</p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="https://github.com/uqfoundation/klepto">klepto</a> In-memory and archival cache. Works-with/used-by <a class="reference external" href="https://github.com/uqfoundation/pathos">pathos</a> in conjunction with <a class="reference external" href="https://github.com/uqfoundation/dill"><code class="docutils literal notranslate"><span class="pre">dill</span></code></a> (serializer that extends pickle).</p>
<ul>
<li><p>Supported caching algorithms: <code class="docutils literal notranslate"><span class="pre">lfu</span></code>,<code class="docutils literal notranslate"><span class="pre">lru</span></code>,<code class="docutils literal notranslate"><span class="pre">mru</span></code>,<code class="docutils literal notranslate"><span class="pre">rr</span></code>. Does not have the something that takes into account “compute time”.</p></li>
<li><p>Supported archival systems: file, directory,sql-table,sql-database,directory of hdf5 files, single hdf5 file</p></li>
<li><p>Supported key calculations: raw-python objects (obj), hash of obj, str(obj), pickle of obj</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://dask.pydata.org/en/latest/">Dask</a> Execution manager. Dataframe style computations.</p></li>
<li><p><a class="reference external" href="https://github.com/dask/cachey">cachey</a> Cache that works with Dask. In-memory only. Simple dictionary style interface. Uses formula to compute priority of data abssed on size, use, and time to compute.</p></li>
<li><p>key/value memory caching servises from the database-driven website community:</p>
<ul>
<li><p><a class="reference external" href="http://memcached.org/">memcached</a> (<a class="reference external" href="https://en.wikipedia.org/wiki/Memcached">wikipedia</a>)</p></li>
<li><p><a class="reference external" href="https://redis.io/">redis</a> (<a class="reference external" href="https://en.wikipedia.org/wiki/Redis">wikipedia</a>)</p>
<ul>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Geohash">geohash</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="https://github.com/kquick/Thespian">Thespian</a> Python Actor package. Supports several underlying communication systems, including TCP and UDP network bassed communication for multiprocess, either single or multi-computer, systems. Communication is restricted to objects that can be pickled and there is no shared memory. Looks like a mature but not neglected package, and the Actor model of parallel/concurrent execution can be pretty easy to reason about.</p></li>
</ul>
</li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2019, Creare

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>